#!/bin/bash

case $1 in
  build)
    docker-compose build $2
    ;;

  up)
    docker-compose up --no-log-prefix ${@:2}
    ;;

  stop)
    docker-compose stop $2
    ;;

  restart)
    docker-compose restart $2
    ;;

  prune)
    docker system prune
    ;;

  logs)
    docker-compose logs -f --no-log-prefix --tail 100 $2
    ;;

  shell)
    docker-compose run --rm $2 bash
    ;;

  format)
    bash scripts/format.sh
    ;;

  lint)
    bash scripts/lint.sh
    ;;

  get-env)
    python3 scripts/get_dot_env.py $2
    ;;

  manage)
    docker-compose run --rm django python manage.py ${@:2}
    ;;

  makemigrations)
    docker-compose run --rm django python manage.py makemigrations ${@:2}
    ;;

  showmigrations)
    docker-compose run --rm django python manage.py showmigrations ${@:2}
    ;;

  migrate)
    docker-compose run --rm django python manage.py migrate ${@:2}
    ;;

  migrate-dynamodb)
    docker-compose run --rm django python manage.py migrate_dynamodb
    ;;

  plus)
    docker-compose run --rm django python manage.py shell_plus
    ;;

  test)
    docker-compose run --rm django bash scripts/test.sh ${@:2}
    ;;

  coverage)
    docker-compose run --rm django bash -c 'coverage html && coverage report'
    ;;

  dumpdata)
    docker-compose run --rm django python manage.py dumpdata ${@:2}
    ;;

  loaddata)
    docker-compose run --rm django python manage.py loaddata ${@:2}
    ;;

  makemessages)
    docker-compose run --rm django python manage.py makemessages ${@:2}
    ;;

  compilemessages)
    docker-compose run --rm django python manage.py compilemessages ${@:2}
    ;;

  update_translation_fields)
    docker-compose run --rm django python manage.py update_translation_fields ${@:2}
    ;;

  compile-emails)
    bash scripts/compile-emails.sh
    ;;

  notebook)
    docker-compose run --publish 8888:8888 --rm django python manage.py shell_plus --lab
    ;;

  purge-celery)
    docker-compose run --rm celery celery purge
    ;;

  rmdb)
    docker-compose run --rm django python manage.py reset_db -D $2
    ;;

  *)
    docker-compose ${@}
    ;;
esac
